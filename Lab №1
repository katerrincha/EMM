##-------------------------------- ‚Ññ1. AR(p) -----------------------------------

library("stats")

# 1. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(1), –∏–∑ ùëõ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π, –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö 
# –∑–Ω–∞—á–µ–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ ùúÉ: a) |ùúÉ| < 1, b) |ùúÉ| = 1, c) |ùúÉ| > 1.

n = 1000
mas = array(n)
mas
sel = rnorm(n, 0, 1)
sel
AR1 = function(n, theta) 
{
  mas[1] = 0
  for (i in 2 : n) 
  {
    mas[i] = theta*mas[i-1] + sel[i]
  }
  mas
}
#|ùúÉ| < 1
x1 = AR1(n, 0.2) 
x1 
# |ùúÉ| = 1
x2 = AR1(n, 1)
# |ùúÉ| > 1
x3 = AR1(n, 1.9) 
plot(x1, type = 'l') # –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
plot(x2, type = 'l')
plot(x3, type = 'l')


# 2. –û—Ü–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä |ùúÉ| ‚â§ 1 –ø–æ –º–µ—Ç–æ–¥—É –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ (–ú–ù–ö). –î–ª—è
# —ç—Ç–æ–≥–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –ø–æ ùúÉ —Å—É–º–º—É –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –æ—à–∏–±–æ–∫

s1 = s2 = 0
MNK = function(x, n) 
{
  s1 = s2 = 0
  for (i in 2 : n) 
  {
    s1 = s1 + (x[i-1])^2
    s2 = s2 + x[i-1]*x[i]
  }
  s2/s1 
} 
theta1 = MNK(x1, n) # –æ—Ü–µ–Ω–∫–∞ |ùúÉ| ‚â§ 1 –¥–ª—è —Ö1
theta1


# 3. –ù–∞–π—Ç–∏ –æ—Ü–µ–Ω–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–∏—è (–ú–ü) –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ ùúÉ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(1). 
# –°–¥–µ–ª–∞–π—Ç–µ –≤—ã–≤–æ–¥ –æ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∏ –æ—Ü–µ–Ω–æ–∫ –ú–ù–ö –∏ –ú–ü –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤ —Å–ª—É—á–∞–µ 
# –≥–∞—É—Å—Å–æ–≤—Å–∫–æ–≥–æ —à—É–º–∞.

s = 0
f = function(theta) 
{
  for (i in 2 : n) 
    s = s + (x1[i] - x1[i-1]*theta)^2
  s
}
theta2 = optimise(f, interval = c(-100,100))
theta2$minimum # –ø–æ–ª—É—á–∏–ª–∏, —á—Ç–æ –æ—Ü–µ–Ω–∫–∏ –ø–æ –º–µ—Ç–æ–¥—É –ú–ù–ö –∏ –ø–æ –º–µ—Ç–æ–¥—É –ú–ü –æ–¥–∏–Ω–∞–∫–æ–≤—ã (theta1 = theta2)


# 4. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ú–ù–ö-–æ—Ü–µ–Ω–∫–∏ –¥–ª—è –æ–±—ä–µ–º–∞ –≤—ã–±–æ—Ä–∫–∏ ùëò = 10, 11, . . . , ùëõ. 
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –¥–∏–Ω–∞–º–∏–∫—É –æ—Ü–µ–Ω–∫–∏, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—ä–µ–º–∞ –≤—ã–±–æ—Ä–∫–∏, –∏ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥—ã.
# –ê–õ–ì–û–†–ò–¢–ú
#(a) –ó–∞–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å AR(1) –æ–±—ä–µ–º–∞ –≤—ã–±–æ—Ä–∫–∏ ùëõ = 1000;
#(b) –†–∞—Å—á–∏—Ç–∞—Ç—å –ú–ù–ö-–æ—Ü–µ–Ω–∫—É –ø–æ 10 –Ω–∞–±–ª—é–¥–µ–Ω–∏—è–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞;
#(c) –†–∞—Å—á–∏—Ç–∞—Ç—å –ú–ù–ö-–æ—Ü–µ–Ω–∫—É –ø–æ 11 –Ω–∞–±–ª—é–¥–µ–Ω–∏—è–º –∏ —Ç.–¥. –¥–ª—è –≤—Å–µ—Ö ùëò = 10,11, . . . ,ùëõ;
#(d) –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ.

n2 = 1000 # –º–æ–¥–µ–ª–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ—Å—Å AR(1) –æ–±—ä–µ–º–∞ –≤—ã–±–æ—Ä–∫–∏ ùëõ = 1000;
proc = AR1(n2, theta1)

aver1 = array(n2) # —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ú–ù–ö-–æ—Ü–µ–Ω–∫—É –ø–æ ùëò = 10,11, . . . ,ùëõ;
for (i in 10 : 1000) 
{
  aver1[i-9] = MNK(proc, i)
}
plot(aver1, type = 'l', main = "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –ú–ù–ö-–æ—Ü–µ–Ω–æ–∫:")


#5. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(2), –∏–∑ ùëõ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π. –î–ª—è —Ç–æ–≥–æ, 
# —á—Ç–æ–±—ã –ø—Ä–æ—Ü–µ—Å—Å AR(2) –±—ã–ª —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –∫–æ—Ä–Ω–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏—è
#ùúÜ^2 ‚àí ùúÉ1ùúÜ ‚àí ùúÉ2 = 0 —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–ª–∏ —É—Å–ª–æ–≤–∏—é |ùúÜùëñ| < 1, ùëñ = 1, 2. 

lam = array(n)
AR2 = function(t1, t2) 
{
  lam[1] = 1
  lam[2] = 2
  for (i in 3 : n) 
    lam[i] = t1*lam[i - 1] + t2*lam[i - 2] + sel[i]
  lam
}
aver2 = AR2(0.7,0.2)
plot(aver2, type = 'l', main = "–ì—Ä–∞—Ñ–∏–∫ —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(2):")


# 6. –í—ã—á–∏—Å–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ AR(2), –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é arima –ø–∞–∫–µ—Ç–∞ stats.
arima(aver2, order = c(2, 0, 0), include.mean = FALSE)

